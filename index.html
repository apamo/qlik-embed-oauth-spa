<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="./styles.css" />
    <title>@qlik/embed-web-components example</title>
    <script
      crossorigin="anonymous"
      type="application/javascript"
      src="https://cdn.jsdelivr.net/npm/@qlik/embed-web-components"
      data-host="https://<TENANT_HOSTNAME>.<REGION>.qlikcloud.com"
      data-client-id="<OAUTH_SPA_CLIENT_ID_FROM_TENANT>"
      data-redirect-uri="<WEB_APPLICATION_CALLBACK_PAGE>"
      data-access-token-storage="session"
      data-auth-type="Oauth2"
      data-auto-redirect="true"
    ></script>
  </head>
  <body>
    <h1>
      Hello @qlik/embed-web-components
    </h1>
    <p>
      This example uses the new embed.js library from Qlik to embed visualizations and the Qlik Sense client using OAuth2 single-page application flow.
    </p>
    <div>
      <qlik-embed
        ui="selections"
        app-id="a51a902d-76a9-4c53-85d2-066b44240146">
        </qlik-embed>
    </div>
    <div>
      <div class="viz">
        <qlik-embed
          id="field_acount"
          ui="field"
          app-id="a51a902d-76a9-4c53-85d2-066b44240146"
          field-id="AccountDesc"
        ></qlik-embed>
      </div>
    </div>
      <div class="viz" style="float:left;">
        <qlik-embed
          id="visualization"
          ui="analytics/chart"
          app-id="a51a902d-76a9-4c53-85d2-066b44240146"
          object-id="ZxDKp"
          context:json="{theme:'breeze', language:'de'}"
          disable-cell-padding="true"
        ></qlik-embed>
      </div>
      <div class="viz" style="margin-left: 50%;">
        <qlik-embed
          ui="object"
          app-id="a51a902d-76a9-4c53-85d2-066b44240146"
          object-id="nvqpV"
        ></qlik-embed>
      </div>
    <p>Here's an example of an entire app</p>
    <div class="app">
      <qlik-embed
        ui="classic/app"
        app-id="a51a902d-76a9-4c53-85d2-066b44240146"
        sheet-id="FaQeFa"
        theme="breeze"
        bookmark="uFjMpUZ"
        select:json="[{field:'AccountDesc',values:['Claims','Commission']}]"
      ></qlik-embed>
    </div>
    <select id="sheetdrop" name="SheetList">
</select>
    <div class="app">
      <qlik-embed
        id="sheetItem"
        ui="object"
        app-id="a51a902d-76a9-4c53-85d2-066b44240146"
        object-id="e2047b0f-193c-40b9-8e0f-4a2161a47ee9"
      ></qlik-embed>
    </div>
  </body>
  <script type="module">


    const element = document.getElementById("visualization");
    const sheetItem = document.getElementById("sheetItem");
    const refApi = await element.getRefApi();
    //const obj = await refApi.getObject();
    const doc = await refApi.getDoc();
    //const appProps = await refApi.getAppLayout();
    const myList = await doc.getSheetList();
    console.log("myList");
    console.log(myList);
const obj = await doc.createSessionObject({
      "qInfo": {
        "qId": "sheetList",
        "qType": "SheetList"
      },
      "qAppObjectListDef": {
        "qType": "sheet",
        "qData": {
          "title": "/qMetaDef/title",
          "thumbnail": "/thumbnail",
          "cells": "/cells",
          "rank": "/rank",
          "columns": "/columns",
          "rows": "/rows"
        }
      }
    });
const sheetsLayout = await obj.getLayout();
const sheetList = sheetsLayout.qAppObjectList.qItems;
    let dd = document.getElementById('sheetdrop');
    dd.length = 0;
    let defaultOption = document.createElement('option');
    defaultOption.text = "Select a sheet to navigate to";
    dd.add(defaultOption);
    dd.selectedIndex=0;

    let option;
    for (let i=0;i<myList.length; i++) {
      option = document.createElement('option');
      option.text = myList[i].qMeta.title;
      option.value = myList[i].qMeta.id;
      dd.add(option);
    }

    dd.addEventListener("change", function() {
      if (dd.selectedIndex > 0)
      {
        //console.log(dd.options[dd.selectedIndex].value);
        let selOption = dd.options[dd.selectedIndex];
        console.log(selOption.value);
        sheetItem.setAttribute('object-id', selOption.value);
      }
    });

  </script>
</html>
